-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.interventions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  status text CHECK (status = ANY (ARRAY['monitoring'::text, 'under_review'::text, 'escalated'::text, 'resolved'::text])),
  assigned_by uuid,
  notes text,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT interventions_pkey PRIMARY KEY (id),
  CONSTRAINT interventions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id),
  CONSTRAINT interventions_assigned_by_fkey FOREIGN KEY (assigned_by) REFERENCES auth.users(id)
);
CREATE TABLE public.journals (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  content text NOT NULL,
  entry_date date NOT NULL,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT journals_pkey PRIMARY KEY (id),
  CONSTRAINT journals_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.mood_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  mood_score integer CHECK (mood_score >= 1 AND mood_score <= 10),
  entry_date date NOT NULL,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT mood_logs_pkey PRIMARY KEY (id),
  CONSTRAINT mood_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.profiles (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  full_name text NOT NULL,
  age integer,
  gender text,
  affiliation_type text CHECK (affiliation_type = ANY (ARRAY['student'::text, 'employee'::text, 'individual'::text, 'community'::text])),
  affiliation_name text,
  external_identifier text,
  created_at timestamp without time zone DEFAULT now(),
  last_checkin timestamp without time zone,
  CONSTRAINT profiles_pkey PRIMARY KEY (id)
);
CREATE TABLE public.sentiment_analysis (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  journal_id uuid,
  sentiment_score numeric,
  emotion_label text,
  created_at timestamp without time zone DEFAULT now(),
  sentiment text text,
  CONSTRAINT sentiment_analysis_pkey PRIMARY KEY (id),
  CONSTRAINT sentiment_analysis_journal_id_fkey FOREIGN KEY (journal_id) REFERENCES public.journals(id)
);
CREATE TABLE public.sleep_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  sleep_hours numeric,
  sleep_quality integer CHECK (sleep_quality >= 1 AND sleep_quality <= 10),
  entry_date date NOT NULL,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT sleep_logs_pkey PRIMARY KEY (id),
  CONSTRAINT sleep_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.stress_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  stress_level integer CHECK (stress_level >= 1 AND stress_level <= 10),
  trigger text,
  entry_date date NOT NULL,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT stress_logs_pkey PRIMARY KEY (id),
  CONSTRAINT stress_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.wellbeing_scores (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  mood_avg numeric,
  stress_avg numeric,
  sleep_avg numeric,
  sentiment_avg numeric,
  composite_score numeric,
  risk_level text CHECK (risk_level = ANY (ARRAY['low'::text, 'medium'::text, 'high'::text])),
  calculated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT wellbeing_scores_pkey PRIMARY KEY (id),
  CONSTRAINT wellbeing_scores_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id)
);